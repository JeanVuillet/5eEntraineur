<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quiz â€“ Les deux empires</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f8fafc;
      color: #222;
      max-width: 750px;
      margin: 50px auto;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    h2 { text-align:center; margin-top: 0; color:#34495e; font-weight: 500; }

    #mainProgress {
      background-color: #e0e0e0;
      border-radius: 15px;
      overflow: hidden;
      height: 30px;
      margin-bottom: 20px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    }
    #mainBar {
      height: 100%;
      width: 0%;
      background-color: #4caf50;
      transition: width 0.5s;
    }

    #subBars {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
      margin-bottom: 20px;
    }

    .subProgress {
      background-color: #ddd;
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      position: relative;
    }
    .subBar {
      height: 100%;
      width: 0%;
      background-color: #2196f3;
      transition: width 0.5s;
    }
    .subLabel {
      position: absolute;
      top: 0;
      left: 8px;
      font-size: 0.9em;
      color: #fff;
      text-shadow: 0 0 3px #000;
      line-height: 20px;
    }

    #question { font-size: 1.2em; margin-top: 25px; }
    #feedback { margin-top: 15px; font-weight: bold; min-height: 1.4em; }
    input, button { padding: 10px; font-size: 1em; margin-top: 10px; }
    input#answer { width:100%; box-sizing: border-box; }
    button {
      background: #4caf50;
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    .muted { color:#6b7280; font-size: .95em; text-align:center; margin-top: 6px; }
  </style>
</head>
<body>

<h1>Les deux empires ğŸ°</h1>
<h2 id="levelTitle">Niveau 1 : repÃ¨res</h2>
<div id="mainProgress"><div id="mainBar"></div></div>
<p id="general" class="muted">Compteur gÃ©nÃ©ral : 0/0</p>
<div id="subBars"></div>
<p id="question"></p>
<input type="text" id="answer" placeholder="Ta rÃ©ponse ici">
<button id="submit">Valider</button>
<p id="feedback"></p>

<script>
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// CONFIG DES NIVEAUX
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const levels = [
  {
    title: "Niveau 1 : repÃ¨res",
    placeholder: "RÃ©ponds par un mot-clÃ©",
    questions: [
      {q: "Quel empire se trouve Ã  lâ€™Ouest de lâ€™Europe au dÃ©but du Moyen Ã‚ge ?", a: "carolingien"},
      {q: "Quel empire se trouve Ã  lâ€™Est de lâ€™Europe, centrÃ© sur Constantinople ?", a: "byzantin"},
      {q: "Quelle est la capitale de lâ€™Empire carolingien ?", a: "aix"},
      {q: "Quelle est la capitale de lâ€™Empire byzantin ?", a: "constantinople"},
      {q: "Quelle est la religion dominante dans lâ€™Empire carolingien ?", a: "catholique"},
      {q: "Quelle est la religion dominante dans lâ€™Empire byzantin ?", a: "orthodoxe"},
    ],
    requiredPerQuestion: 3,
    startScore: 1,
    wrongPenalty: 2
  },
  {
    title: "Niveau 2 : les dates",
    placeholder: "RÃ©ponds par une date (ex : 800, 527-565)",
    questions: [
      {q: "Fin de lâ€™Empire romain dâ€™Occident ?", validate: (t)=> onlyDigits(t)==="476", a: "476"},
      {q: "Couronnement de Charlemagne ?", validate: (t)=> onlyDigits(t)==="800", a: "800"},
      {q: "Fin de lâ€™Empire byzantin (prise de Constantinople) ?", validate: (t)=> onlyDigits(t)==="1453", a: "1453"},
      {q: "RÃ¨gne de Justinien ? (indiquer les bornes)", validate: (t)=> containsBothYears(t,527,565), a: "527-565"},
    ],
    requiredPerQuestion: 3,
    startScore: 1,
    wrongPenalty: 2
  }
];

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// ETAT
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
let currentLevel = 0;
let localScores = [];
let general = 0;
let currentIndex = -1;

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// UTILS
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function onlyDigits(str) { return (str||"").replace(/\D/g, ""); }
function containsBothYears(input,a,b){
  const t = (input||"").toLowerCase().replace(/[^0-9â€“-]/g, "");
  const digits = t.replace(/[â€“-]/g,"-");
  return digits.includes(""+a) && digits.includes(""+b);
}
function normalise(txt){ return (txt||"").trim().toLowerCase(); }

function findNextIndex(fromIdx) {
  const lvl = levels[currentLevel];
  const req = lvl.requiredPerQuestion;
  const n = lvl.questions.length;
  for (let i = fromIdx + 1; i < n; i++) if (localScores[i] < req) return i;
  for (let i = 0; i <= fromIdx; i++) if (localScores[i] < req) return i;
  return null;
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// RENDU UI
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const mainBar = document.getElementById("mainBar");
const generalText = document.getElementById("general");
const subBarsContainer = document.getElementById("subBars");
const qElt = document.getElementById("question");
const levelTitle = document.getElementById("levelTitle");
const inputElt = document.getElementById("answer");

function setupLevel(levelIdx){
  const lvl = levels[levelIdx];
  levelTitle.textContent = lvl.title;
  inputElt.placeholder = lvl.placeholder;

  localScores = new Array(lvl.questions.length).fill(lvl.startScore);
  general = 0;
  currentIndex = -1;

  subBarsContainer.innerHTML = "";
  lvl.questions.forEach((q, i) => {
    const barContainer = document.createElement("div");
    barContainer.classList.add("subProgress");
    const bar = document.createElement("div");
    bar.classList.add("subBar");
    bar.id = "subBar" + i;
    const label = document.createElement("div");
    label.classList.add("subLabel");
    label.textContent = i + 1;
    barContainer.appendChild(bar);
    barContainer.appendChild(label);
    subBarsContainer.appendChild(barContainer);
  });

  updateBars();
  nextQuestion();
}

function updateBars() {
  const total = levels[currentLevel].questions.length;
  mainBar.style.width = (general / total) * 100 + "%";
  generalText.textContent = `Compteur gÃ©nÃ©ral : ${general}/${total}`;
  const req = levels[currentLevel].requiredPerQuestion;
  levels[currentLevel].questions.forEach((_, i) => {
    const bar = document.getElementById("subBar" + i);
    const val = Math.max(0, Math.min(localScores[i], req));
    bar.style.width = (val / req) * 100 + "%";
  });
}

function nextQuestion() {
  const lvl = levels[currentLevel];
  if (general >= lvl.questions.length) {
    if (currentLevel < levels.length - 1) {
      qElt.textContent = "ğŸ‰ Bravo ! Niveau " + (currentLevel + 1) + " terminÃ© ! Passage au niveau suivantâ€¦";
      document.getElementById("feedback").textContent = "";
      document.getElementById("submit").disabled = true;
      setTimeout(()=>{
        document.getElementById("submit").disabled = false;
        currentLevel++;
        setupLevel(currentLevel);
      }, 1500);
      return;
    } else {
      qElt.textContent = "ğŸ Bravo ! Tu as terminÃ© les deux niveaux !";
      document.getElementById("submit").disabled = true;
      return;
    }
  }

  const nxt = findNextIndex(currentIndex);
  if (nxt === null) return;
  currentIndex = nxt;

  qElt.textContent = lvl.questions[currentIndex].q;
  document.getElementById("feedback").textContent = "";
  document.getElementById("answer").value = "";
  inputElt.focus();
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
// LOGIQUE DE REPONSE
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
document.getElementById("submit").addEventListener("click", () => {
  const inputRaw = document.getElementById("answer").value;
  if (!inputRaw) return;

  const lvl = levels[currentLevel];
  let isCorrect = false;
  const q = lvl.questions[currentIndex];
  if (q.validate) {
    isCorrect = q.validate(inputRaw);
  } else {
    const correct = normalise(q.a);
    const input = normalise(inputRaw);
    isCorrect = input.includes(correct);
  }

  if (isCorrect) {
    localScores[currentIndex] = Math.min(localScores[currentIndex] + 1, lvl.requiredPerQuestion);
    document.getElementById("feedback").textContent = "âœ… Bonne rÃ©ponse !";
    if (localScores[currentIndex] === lvl.requiredPerQuestion) {
      general++;
      document.getElementById("feedback").textContent += " Question validÃ©e ğŸ¯";
    }
    updateBars();
    setTimeout(nextQuestion, 1200);
  } else {
    localScores[currentIndex] = Math.max(localScores[currentIndex] - lvl.wrongPenalty, 0);
    const correction = q.a ? `La bonne rÃ©ponse Ã©tait : "${q.a}".` : "";
    document.getElementById("feedback").textContent = `âŒ Mauvaise rÃ©ponse. ${correction}`;
    updateBars();
    setTimeout(nextQuestion, 3000); // attendre 3 secondes avant question suivante
  }
});

setupLevel(0);
</script>

</body>
</html>
